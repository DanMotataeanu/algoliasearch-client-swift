<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Offline mode  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="Offline mode  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">AlgoliaSearch Docs</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">AlgoliaSearch Reference</a>
        <img id="carat" src="img/carat.png" />
        Offline mode  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="API Client.html">API Client</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/Client.html">Client</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Client/MultipleQueriesStrategy.html">– MultipleQueriesStrategy</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Index.html">Index</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Query.html">Query</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Query/QueryType.html">– QueryType</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Query/TypoTolerance.html">– TypoTolerance</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Query/IgnorePlurals.html">– IgnorePlurals</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Query/RemoveWordsIfNoResults.html">– RemoveWordsIfNoResults</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Query/RemoveStopWords.html">– RemoveStopWords</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Query/ExactOnSingleWordQuery.html">– ExactOnSingleWordQuery</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Query/AlternativesAsExact.html">– AlternativesAsExact</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Query/AroundRadius.html">– AroundRadius</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Query/SortFacetValuesBy.html">– SortFacetValuesBy</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/BrowseIterator.html">BrowseIterator</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Places.html">Places</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/PlacesClient.html">PlacesClient</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PlacesQuery.html">PlacesQuery</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PlacesQuery/Type.html">– Type</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PlacesQuery/AroundRadius.html">– AroundRadius</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Auxiliary types.html">Auxiliary types</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/GeoRect.html">GeoRect</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/IndexQuery.html">IndexQuery</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/LatLng.html">LatLng</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/LibraryVersion.html">LibraryVersion</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Offline mode.html">Offline mode</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/OfflineClient.html">OfflineClient</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/MirroredIndex.html">MirroredIndex</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/MirroredIndex/Strategy.html">– Strategy</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DataSelectionQuery.html">DataSelectionQuery</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/OfflineIndex.html">OfflineIndex</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/OfflineIndex/WriteTransaction.html">– WriteTransaction</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Errors.html">Errors</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/HTTPError.html">HTTPError</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/InvalidJSONError.html">InvalidJSONError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/StatusCode.html">StatusCode</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other Classes.html">Other Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/AbstractClient.html">AbstractClient</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/AbstractQuery.html">AbstractQuery</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/RequestOptions.html">RequestOptions</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other Protocols.html">Other Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/Searchable.html">Searchable</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other Typealiases.html">Other Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Other Typealiases.html#/s:20AlgoliaSearch21BrowseIteratorHandlera">BrowseIteratorHandler</a>
              </li>
              <li class="nav-group-task">
                <a href="Other Typealiases.html#/s:20AlgoliaSearch17CompletionHandlera">CompletionHandler</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            <h1>Offline mode</h1>
            
          </section>
          <section class="section task-group-section">
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/c:@M@AlgoliaSearch@objc(cs)OfflineClient"></a>
                    <a name="//apple_ref/swift/Class/OfflineClient" class="dashAnchor"></a>
                    <a class="token" href="#/c:@M@AlgoliaSearch@objc(cs)OfflineClient">OfflineClient</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>An API client that adds offline features on top of the regular online API client.</p>
<div class="aside aside-note">
    <p class="aside-title">Note</p>
    Requires Algolia&rsquo;s Offline Core SDK. The <code>enableOfflineMode(...)</code> method must be called with a valid license
key prior to calling any offline-related method.

</div>

                        <a href="Classes/OfflineClient.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">@objc</span> <span class="kd">public</span> <span class="kd">class</span> <span class="kt">OfflineClient</span> <span class="p">:</span> <span class="kt"><a href="Classes/Client.html">Client</a></span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/c:@M@AlgoliaSearch@objc(cs)MirroredIndex"></a>
                    <a name="//apple_ref/swift/Class/MirroredIndex" class="dashAnchor"></a>
                    <a class="token" href="#/c:@M@AlgoliaSearch@objc(cs)MirroredIndex">MirroredIndex</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>An online index that can also be mirrored locally.</p>
<div class="aside aside-note">
    <p class="aside-title">Note</p>
    <p>You cannot construct this class directly. Please use <code><a href="Classes/OfflineClient.html#/c:@M@AlgoliaSearch@objc(cs)OfflineClient(im)indexWithName:">OfflineClient.index(withName:)</a></code> to obtain an
instance.</p>

</div>
<div class="aside aside-note">
    <p class="aside-title">Note</p>
    <p>Requires Algolia Offline Core. The <code><a href="Classes/OfflineClient.html#/c:@M@AlgoliaSearch@objc(cs)OfflineClient(im)enableOfflineModeWithLicenseKey:">OfflineClient.enableOfflineMode(...)</a></code> method must be called with a
valid license key prior to calling any offline-related method.</p>

</div>

<p>When created, an instance of this class has its <code>mirrored</code> flag set to false, and behaves like a normal,
online <code><a href="Classes/Index.html">Index</a></code>. When the <code>mirrored</code> flag is set to true, the index becomes capable of acting upon local data.</p>
<div class="aside aside-warning">
    <p class="aside-title">Warning</p>
    It is a programming error to call methods acting on the local data when <code>mirrored</code> is false. Doing so
will result in an assertion error being raised.

</div>
<h2 id='request-strategy' class='heading'>Request strategy</h2>

<p>When the index is mirrored and the device is online, it becomes possible to transparently switch between online and
offline requests. There is no single best strategy for that, because it depends on the use case and the current
network conditions. You can choose the strategy through the <code>requestStrategy</code> property. The default is
<code>FallbackOnFailure</code>, which will always target the online API first, then fallback to the offline mirror in case of
failure (including network unavailability).</p>
<div class="aside aside-note">
    <p class="aside-title">Note</p>
    <p>If you want to explicitly target either the online API or the offline mirror, doing so is always possible
using <code>searchOnline(...)</code> or <code>searchOffline(...)</code>.</p>

</div>
<div class="aside aside-note">
    <p class="aside-title">Note</p>
    <p>The strategy applies to:</p>

<ul>
<li><code>search(...)</code></li>
<li><code>searchDisjunctiveFaceting(...)</code></li>
<li><code>multipleQueries(...)</code></li>
<li><code>getObject(...)</code></li>
<li><code>getObjects(...)</code></li>
</ul>

</div>
<h2 id='bootstrapping' class='heading'>Bootstrapping</h2>

<p>Before the first sync has successfully completed, a mirrored index is not available offline, because it has simply
no data to search in yet. In most cases, this is not a problem: the app will sync as soon as instructed, so unless
the device is offline when the app is started for the first time, or unless search is required right after the
first launch, the user should not notice anything.</p>

<p>However, in some cases, you might need to have offline data available as soon as possible. To achieve that,
<code>MirroredIndex</code> provides a <strong>manual build</strong> feature.</p>
<h3 id='manual-build' class='heading'>Manual build</h3>

<p>Manual building consists in specifying the source data for your index from local files, instead of downloading it
from the API. Namely, you need:</p>

<ul>
<li>the <strong>index settings</strong> (one JSON file); and</li>
<li>the <strong>objects</strong> (as many JSON files as needed, each containing an array of objects).</li>
</ul>

<p>Those files are typically embedded in the application as resources, although any other origin works too.</p>
<h3 id='conditional-bootstrapping' class='heading'>Conditional bootstrapping</h3>

<p>To avoid replacing the local mirror every time the app is started (and potentially overwriting more recent data
synced from the API), you should test whether the index already has offline data using the <code>hasOfflineData</code>
property.</p>
<h4 id='discussion' class='heading'>Discussion</h4>
<div class="aside aside-warning">
    <p class="aside-title">Warning</p>
    We strongly advise against prepackaging index files. While it may work in some cases, Algolia Offline
makes no guarantee whatsoever that the index file format will remain backward-compatible forever, nor that it
is independent of the hardware architecture (e.g. 32 bits vs 64 bits, or Little Endian vs Big Endian). Instead,
always use the manual build feature.

</div>

<p>While a manual build involves computing the offline index on the device, and therefore incurs a small delay before
the mirror is actually usable, using plain JSON offers several advantages compared to prepackaging the index file
itself:</p>

<ul>
<li><p>You only need to ship the raw object data, which is smaller than shipping an entire index file, which contains
both the raw data <em>and</em> indexing metadata.</p></li>
<li><p>Plain JSON compresses well with standard compression techniques like GZip, whereas an index file uses a binary
format which doesn&rsquo;t compress very efficiently.</p></li>
<li><p>Build automation is facilitated: you can easily extract the required data from your back-end, whereas building
an index would involve running the app on each mobile platform as part of your build process and capturing the
filesystem.</p></li>
</ul>

<p>Also, the build process is purposedly single-threaded across all indices, which means that on most modern devices
with multi-core CPUs, the impact of manual building on the app&rsquo;s performance will be very moderate, especially
regarding UI responsiveness.</p>
<h2 id='limitations' class='heading'>Limitations</h2>

<p>Algolia&rsquo;s core features are fully supported offline, including (but not limited to): <strong>ranking</strong>,
<strong>typo tolerance</strong>, <strong>filtering</strong>, <strong>faceting</strong>, <strong>highlighting/snippeting</strong>&hellip;</p>

<p>However, and partly due to tight memory, CPU and disk space constraints, some features are disabled:</p>

<ul>
<li><p><strong>Synonyms</strong> are only partially supported:</p>

<ul>
<li>Multi-way (<q>regular</q>) synonyms are fully supported.</li>
<li>One-way synonyms are not supported.</li>
<li>Alternative corrections are limited to one alternative (compared to multiple alternatives with online indices).</li>
<li>Placeholders are fully supported.</li>
</ul></li>
<li><p>Dictionary-based <strong>plurals</strong> are not supported. (<q>Simple</q> plurals with a final S are supported.)</p></li>
<li><p><strong>IP geolocation</strong> (see <code><a href="Classes/Query.html#/s:20AlgoliaSearch5QueryC17aroundLatLngViaIPSbSgv">Query.aroundLatLngViaIP</a></code>) is not supported.</p></li>
<li><p><strong>CJK segmentation</strong> is not supported.</p></li>
</ul>
<h2 id='resource-handling' class='heading'>Resource handling</h2>

<p>Native resources are lazily instantiated when <code>mirrored</code> is set to <code>true</code>. They are released when the object is
released, or if <code>mirrored</code> is set to <code>false</code> again.</p>

                        <a href="Classes/MirroredIndex.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">@objc</span> <span class="kd">public</span> <span class="kd">class</span> <span class="kt">MirroredIndex</span> <span class="p">:</span> <span class="kt"><a href="Classes/Index.html">Index</a></span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/c:@M@AlgoliaSearch@objc(cs)DataSelectionQuery"></a>
                    <a name="//apple_ref/swift/Class/DataSelectionQuery" class="dashAnchor"></a>
                    <a class="token" href="#/c:@M@AlgoliaSearch@objc(cs)DataSelectionQuery">DataSelectionQuery</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>A data selection query, used to select data to be mirrored locally by a <code><a href="Classes/MirroredIndex.html">MirroredIndex</a></code>.</p>

                        <a href="Classes/DataSelectionQuery.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">@objc</span> <span class="kd">public</span> <span class="kd">class</span> <span class="kt">DataSelectionQuery</span><span class="p">:</span> <span class="kt">NSObject</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/c:@M@AlgoliaSearch@objc(cs)OfflineIndex"></a>
                    <a name="//apple_ref/swift/Class/OfflineIndex" class="dashAnchor"></a>
                    <a class="token" href="#/c:@M@AlgoliaSearch@objc(cs)OfflineIndex">OfflineIndex</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>A purely offline index.
Such an index has no online counterpart. It is updated and queried locally.</p>
<div class="aside aside-note">
    <p class="aside-title">Note</p>
    <p>You cannot construct this class directly. Please use <code><a href="Classes/OfflineClient.html#/c:@M@AlgoliaSearch@objc(cs)OfflineClient(im)offlineIndexWithName:">OfflineClient.offlineIndex(withName:)</a></code> to obtain an
instance.</p>

</div>
<div class="aside aside-note">
    <p class="aside-title">Note</p>
    <p>Requires Algolia Offline Core. <code><a href="Classes/OfflineClient.html#/c:@M@AlgoliaSearch@objc(cs)OfflineClient(im)enableOfflineModeWithLicenseKey:">OfflineClient.enableOfflineMode(...)</a></code> must be called with a valid license
key prior to calling any offline-related method.</p>

</div>
<h2 id='reading' class='heading'>Reading</h2>

<p>Read operations behave identically as with online indices.</p>
<h2 id='writing' class='heading'>Writing</h2>

<p>Updating an index involves rebuilding it, which is an expensive and potentially lengthy operation. Therefore, all
updates must be wrapped inside a <strong>transaction</strong>.</p>

<p>The procedure to update an index is as follows:</p>

<ul>
<li><p>Create a transaction by calling <code>newTransaction()</code>.</p></li>
<li><p>Populate the transaction: call the various write methods on the <code>WriteTransaction</code> class.</p></li>
<li><p>Either <code>commit()</code> or <code>rollback()</code> the transaction.</p></li>
</ul>
<h3 id='synchronous-vs-asynchronous-updates' class='heading'>Synchronous vs asynchronous updates</h3>

<p>Any write operation, especially (but not limited to) the final commit, is potentially lengthy. This is why all
operations provide an asynchronous version, which accepts an optional completion handler that will be notified of
the operation&rsquo;s completion (either successful or erroneous).</p>

<p>If you already have a background thread/queue performing data-handling tasks, you may find it more convenient to
use the synchronous versions of the write methods. They are named after the asynchronous versions, suffixed by
<code>Sync</code>. The flow is identical to the asynchronous version (see above).</p>
<div class="aside aside-warning">
    <p class="aside-title">Warning</p>
    <p>You must not call synchronous methods from the main thread. The methods will assert if you do so.</p>

</div>
<div class="aside aside-note">
    <p class="aside-title">Note</p>
    <p>The synchronous methods can throw; you have to catch and handle the error.</p>

</div>
<h3 id='parallel-transactions' class='heading'>Parallel transactions</h3>

<p>While it is possible to create parallel transactions, there is little interest in doing so, since each committed
transaction results in an index rebuild. Multiplying transactions therefore only degrades performance.</p>

<p>Also, transactions are serially executed in the order they were committed, the latest transaction potentially
overwriting the previous transactions&rsquo; result.</p>
<h3 id='manual-build' class='heading'>Manual build</h3>

<p>As an alternative to using write transactions, <code>OfflineIndex</code> also offers a <strong>manual build</strong> feature. Provided that
you have:</p>

<ul>
<li>the <strong>index settings</strong> (one JSON file); and</li>
<li>the <strong>objects</strong> (as many JSON files as needed, each containing an array of objects)</li>
</ul>

<p>&hellip; available as local files on disk, you can replace the index&rsquo;s content with that data by calling <code>build(...)</code>.</p>
<h2 id='caveats' class='heading'>Caveats</h2>
<h3 id='limitations' class='heading'>Limitations</h3>

<p>Though offline indices support most features of an online index, there are some limitations:</p>

<ul>
<li><p>Objects <strong>must contain an <code>objectID</code></strong> field. The SDK will refuse to index objects without an ID.</p></li>
<li><p><strong>Partial updates</strong> are not supported.</p></li>
<li><p><strong>Replica indices</strong> are not supported.</p></li>
</ul>
<h3 id='differences' class='heading'>Differences</h3>

<ul>
<li><p><strong>Settings</strong> are not incremental: the new settings completely replace the previous ones. If a setting
is omitted in the new version, it reverts back to its default value. (This is in contrast with the online API,
where you can only specify the settings you want to change and omit the others.)</p></li>
<li><p>You cannot batch arbitrary write operations in a single method call (as you would do with <code><a href="Classes/Index.html#/c:@M@AlgoliaSearch@objc(cs)Index(im)batchOperations:requestOptions:completionHandler:">Index.batch(...)</a></code>).
However, all write operations are <em>de facto</em> batches, since they must be wrapped inside a transaction (see below).</p></li>
</ul>

                        <a href="Classes/OfflineIndex.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">@objc</span> <span class="kd">public</span> <span class="kd">class</span> <span class="kt">OfflineIndex</span> <span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt"><a href="Protocols/Searchable.html">Searchable</a></span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
          </section>
        </section>
        <section id="footer">
          <p>© Copyright 2016 <a class="link" href="https://www.algolia.com/" target="_blank" rel="external">Algolia</a>. All rights reserved.</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.1</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
